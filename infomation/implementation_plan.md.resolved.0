# DaVinci Resolve MCP ‚Äî –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

> **–ü—Ä–æ–µ–∫—Ç:** MCP Server –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –º–æ–Ω—Ç–∞–∂–∞ –≤ DaVinci Resolve Studio  
> **–î–∞—Ç–∞:** 31 –¥–µ–∫–∞–±—Ä—è 2024  
> **–°—Ç–∞—Ç—É—Å:** –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω, –ø–ª–∞–Ω –≥–æ—Ç–æ–≤ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é

---

## –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

MCP (Model Context Protocol) —Å–µ—Ä–≤–µ—Ä –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤ (Cursor, Claude Desktop, Antigravity) —Å DaVinci Resolve Studio –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –º–æ–Ω—Ç–∞–∂–∞ —á–µ—Ä–µ–∑ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- 202 —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏
- –¢–æ–ª—å–∫–æ 8% –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ macOS
- 0% –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ Windows
- 82% —Ç—Ä–µ–±—É—é—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

## –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è üî¥

> **–°—Ä–æ–∫:** 1-2 –¥–Ω—è  
> **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

---

### 1.1 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –ø—É—Ç–∏

#### [MODIFY] [whisper_node.py](file:///c:/GenModels/[Antigravity]/projects/test1/davinci-resolve-mcp/src/api/whisper_node.py)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏ –∫ Whisper

```python
# –¢–ï–ö–£–©–ò–ô –ö–û–î (—Å—Ç—Ä–æ–∫–∏ 10-11):
WHISPER_VENV_PYTHON = r"c:\GenModels\Whisper-WebUI\venv\Scripts\python.exe"
WHISPER_GEN_SCRIPT = r"C:\Users\Black\.gemini\whisper_to_json.py"
```

**–†–µ—à–µ–Ω–∏–µ:**
1. –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª `config/whisper_config.json`
2. –î–æ–±–∞–≤–∏—Ç—å fallback –Ω–∞ environment variables
3. –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ Whisper

```python
# –ù–û–í–´–ô –ö–û–î:
import json
from pathlib import Path

def get_whisper_config():
    config_path = Path(__file__).parent.parent.parent / "config" / "whisper_config.json"
    defaults = {
        "whisper_python": os.environ.get("WHISPER_PYTHON", "python"),
        "whisper_script": os.environ.get("WHISPER_SCRIPT", ""),
        "model_size": "large-v3",
        "use_native_resolve_ai": True  # Fallback –Ω–∞ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π AI DaVinci
    }
    if config_path.exists():
        with open(config_path) as f:
            return {**defaults, **json.load(f)}
    return defaults
```

#### [NEW] [whisper_config.json](file:///c:/GenModels/[Antigravity]/projects/test1/davinci-resolve-mcp/config/whisper_config.json)

```json
{
  "whisper_python": "python",
  "whisper_script": "",
  "model_size": "large-v3",
  "use_native_resolve_ai": true,
  "cache_transcriptions": true,
  "supported_languages": ["en", "ru", "auto"]
}
```

---

### 1.2 –ù–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### [MODIFY] [ai_director.py](file:///c:/GenModels/[Antigravity]/projects/test1/davinci-resolve-mcp/src/api/ai_director.py)

**–ü—Ä–æ–±–ª–µ–º–∞:** –§—É–Ω–∫—Ü–∏—è [parse_ai_segments()](file:///c:/GenModels/%5BAntigravity%5D/projects/test1/davinci-resolve-mcp/src/api/ai_director.py#23-33) ‚Äî –ø—É—Å—Ç–∞—è –∑–∞–≥–ª—É—à–∫–∞

```python
# –¢–ï–ö–£–©–ò–ô –ö–û–î (—Å—Ç—Ä–æ–∫–∏ 23-32):
def parse_ai_segments(ai_selection_text: str, whisper_data: dict) -> List[dict]:
    """Parse a list of segments suggested by AI."""
    pass  # <-- –ü–£–°–¢–ê–Ø –§–£–ù–ö–¶–ò–Ø!
```

**–†–µ—à–µ–Ω–∏–µ:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤

```python
def parse_ai_segments(ai_selection_text: str, whisper_data: dict) -> List[dict]:
    """Parse AI-suggested segments from multiple formats.
    
    Supported formats:
    1. JSON: [{"start": 12.5, "end": 45.0, "title": "Hook"}]
    2. Text: "Reel 1: 12.5 - 45.0 (Hook about coding)"
    3. Segment indices: "Segments: 0, 3, 5-8, 12"
    """
    segments = []
    
    # Try JSON first
    try:
        parsed = json.loads(ai_selection_text)
        if isinstance(parsed, list):
            return parsed
    except json.JSONDecodeError:
        pass
    
    # Parse text format: "Reel N: start - end (description)"
    reel_pattern = r"(?:Reel\s*\d*:?)?\s*(\d+\.?\d*)\s*[-‚Äì]\s*(\d+\.?\d*)\s*(?:\(([^)]*)\))?"
    matches = re.findall(reel_pattern, ai_selection_text)
    for match in matches:
        segments.append({
            "start": float(match[0]),
            "end": float(match[1]),
            "title": match[2] if match[2] else f"Segment {len(segments)+1}"
        })
    
    # Parse segment indices: "0, 3, 5-8"
    if not segments and whisper_data:
        whisper_segments = whisper_data.get("segments", [])
        index_pattern = r"(\d+)(?:\s*[-‚Äì]\s*(\d+))?"
        for match in re.findall(index_pattern, ai_selection_text):
            start_idx = int(match[0])
            end_idx = int(match[1]) if match[1] else start_idx
            for idx in range(start_idx, min(end_idx + 1, len(whisper_segments))):
                seg = whisper_segments[idx]
                segments.append({
                    "start": seg.get("start", 0),
                    "end": seg.get("end", 0),
                    "title": seg.get("text", "")[:50]
                })
    
    return segments
```

---

### 1.3 –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Render Pipeline

#### [MODIFY] [delivery_operations.py](file:///c:/GenModels/[Antigravity]/projects/test1/davinci-resolve-mcp/src/api/delivery_operations.py)

**–ü—Ä–æ–±–ª–µ–º–∞:** `AddRenderJob` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `'NoneType' object is not callable`

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É API –≤–µ—Ä—Å–∏–∏ –∏ fallback

```python
def add_to_render_queue(resolve, preset_name: str, ...):
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
    
    # –î–û–ë–ê–í–ò–¢–¨: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–µ—Ç–æ–¥–∞
    project = resolve.GetProjectManager().GetCurrentProject()
    
    # –ú–µ—Ç–æ–¥ 1: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π API
    if hasattr(project, 'AddRenderJob') and callable(getattr(project, 'AddRenderJob')):
        job_id = project.AddRenderJob()
        if job_id:
            return {"success": True, "job_id": job_id}
    
    # –ú–µ—Ç–æ–¥ 2: –ß–µ—Ä–µ–∑ RenderSettings (Resolve 18+)
    render_settings = project.GetRenderFormats()
    if render_settings:
        # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π workflow —á–µ—Ä–µ–∑ LoadRenderPreset
        if project.LoadRenderPreset(preset_name):
            job_id = project.AddRenderJob()
            return {"success": True, "job_id": job_id, "method": "preset_load"}
    
    # –ú–µ—Ç–æ–¥ 3: Manual settings
    return {"error": "AddRenderJob unavailable", 
            "suggestion": "Try switching to Deliver page first: resolve.OpenPage('deliver')"}
```

---

## –§–∞–∑–∞ 2: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è üü°

> **–°—Ä–æ–∫:** 3-5 –¥–Ω–µ–π  
> **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –£–ª—É—á—à–µ–Ω–∏–µ maintainability

---

### 2.1 –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –≥–ª–∞–≤–Ω–æ–≥–æ —Ñ–∞–π–ª–∞

#### [MODIFY] [resolve_mcp_server.py](file:///c:/GenModels/[Antigravity]/projects/test1/davinci-resolve-mcp/src/resolve_mcp_server.py)

**–ü—Ä–æ–±–ª–µ–º–∞:** 4900 —Å—Ç—Ä–æ–∫ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∫–æ–¥–∞ –∏–∑ `src/api/`

**–ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**

| –°–µ–∫—Ü–∏—è | –°—Ç—Ä–æ–∫–∏ | –í—ã–Ω–µ—Å—Ç–∏ –≤ –º–æ–¥—É–ª—å |
|--------|--------|------------------|
| Project Management | 356-658 | [api/project_operations.py](file:///c:/GenModels/%5BAntigravity%5D/projects/test1/davinci-resolve-mcp/src/api/project_operations.py) ‚úÖ —É–∂–µ –µ—Å—Ç—å |
| Timeline Operations | 664-852 | [api/timeline_operations.py](file:///c:/GenModels/%5BAntigravity%5D/projects/test1/davinci-resolve-mcp/src/api/timeline_operations.py) ‚úÖ —É–∂–µ –µ—Å—Ç—å |
| Media Pool | 858-1094 | [api/media_operations.py](file:///c:/GenModels/%5BAntigravity%5D/projects/test1/davinci-resolve-mcp/src/api/media_operations.py) ‚úÖ —É–∂–µ –µ—Å—Ç—å |
| Color Page | 1100-1161 | [api/color_operations.py](file:///c:/GenModels/%5BAntigravity%5D/projects/test1/davinci-resolve-mcp/src/api/color_operations.py) ‚úÖ —É–∂–µ –µ—Å—Ç—å |
| Delivery | 1167-1427 | [api/delivery_operations.py](file:///c:/GenModels/%5BAntigravity%5D/projects/test1/davinci-resolve-mcp/src/api/delivery_operations.py) ‚úÖ —É–∂–µ –µ—Å—Ç—å |
| Transcription | 1430-1603 | **–ù–û–í–´–ô: `api/transcription_operations.py`** |
| Gallery/Stills | ~2000-2500 | **–ù–û–í–´–ô: `api/gallery_operations.py`** |
| Keyframes | ~2500-3000 | **–ù–û–í–´–ô: `api/keyframe_operations.py`** |
| Export/Import | ~3000-3500 | **–ù–û–í–´–ô: `api/export_operations.py`** |

**–ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ resolve_mcp_server.py (~500 —Å—Ç—Ä–æ–∫):**

```python
#!/usr/bin/env python3
"""DaVinci Resolve MCP Server - Main Entry"""

from mcp.server.fastmcp import FastMCP
from src.api import (
    project_operations,
    timeline_operations,
    media_operations,
    color_operations,
    delivery_operations,
    transcription_operations,  # NEW
    gallery_operations,        # NEW
    audio_operations,
    smart_editing
)

mcp = FastMCP("davinci-resolve")

# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è tools —á–µ—Ä–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã
@mcp.tool()
def get_resolve_version(): 
    return project_operations.get_version(resolve)

@mcp.tool()
def list_timelines():
    return timeline_operations.list_timelines(resolve)

# ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ tools –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏
```

---

### 2.2 –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

#### [DELETE] [scripts/resolve_mcp_server.py](file:///c:/GenModels/[Antigravity]/projects/test1/davinci-resolve-mcp/scripts/resolve_mcp_server.py)

**–ü—Ä–∏—á–∏–Ω–∞:** –î—É–±–ª–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å [src/resolve_mcp_server.py](file:///c:/GenModels/%5BAntigravity%5D/projects/test1/davinci-resolve-mcp/src/resolve_mcp_server.py)

---

### 2.3 –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

#### [NEW] [error_handling.py](file:///c:/GenModels/[Antigravity]/projects/test1/davinci-resolve-mcp/src/utils/error_handling.py)

```python
"""–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ DaVinci Resolve API"""

from functools import wraps
from typing import Callable, Any
import logging

logger = logging.getLogger("davinci-resolve-mcp.errors")

class ResolveAPIError(Exception):
    """–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –æ—à–∏–±–æ–∫ API"""
    pass

class ResolveNotConnectedError(ResolveAPIError):
    """DaVinci Resolve –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω"""
    pass

class ProjectNotOpenError(ResolveAPIError):
    """–ü—Ä–æ–µ–∫—Ç –Ω–µ –æ—Ç–∫—Ä—ã—Ç"""
    pass

class TimelineNotFoundError(ResolveAPIError):
    """Timeline –Ω–µ –Ω–∞–π–¥–µ–Ω"""
    pass

class ClipNotFoundError(ResolveAPIError):
    """–ö–ª–∏–ø –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ Media Pool"""
    pass

def require_resolve(func: Callable) -> Callable:
    """–î–µ–∫–æ—Ä–∞—Ç–æ—Ä: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Resolve"""
    @wraps(func)
    def wrapper(resolve, *args, **kwargs):
        if resolve is None:
            raise ResolveNotConnectedError(
                "DaVinci Resolve –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ."
            )
        return func(resolve, *args, **kwargs)
    return wrapper

def require_project(func: Callable) -> Callable:
    """–î–µ–∫–æ—Ä–∞—Ç–æ—Ä: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã–π –ø—Ä–æ–µ–∫—Ç"""
    @wraps(func)
    def wrapper(resolve, *args, **kwargs):
        project = resolve.GetProjectManager().GetCurrentProject()
        if project is None:
            raise ProjectNotOpenError(
                "–ü—Ä–æ–µ–∫—Ç –Ω–µ –æ—Ç–∫—Ä—ã—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ open_project() –∏–ª–∏ create_project()."
            )
        return func(resolve, *args, **kwargs)
    return wrapper

def safe_api_call(default_return: Any = None):
    """–î–µ–∫–æ—Ä–∞—Ç–æ—Ä: –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤—ã–∑–æ–≤ API —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º"""
    def decorator(func: Callable) -> Callable:
        @wraps(func)
        def wrapper(*args, **kwargs):
            try:
                return func(*args, **kwargs)
            except ResolveAPIError:
                raise
            except Exception as e:
                logger.error(f"{func.__name__} failed: {e}")
                return default_return
        return wrapper
    return decorator
```

---

## –§–∞–∑–∞ 3: –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ üü¢

> **–°—Ä–æ–∫:** 1-2 –Ω–µ–¥–µ–ª–∏  
> **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π

---

### 3.1 Fairlight Page Operations (–ê—É–¥–∏–æ)

#### [NEW] [fairlight_operations.py](file:///c:/GenModels/[Antigravity]/projects/test1/davinci-resolve-mcp/src/api/fairlight_operations.py)

```python
"""DaVinci Resolve Fairlight Page Operations"""

import logging
from typing import Dict, Any, List, Optional

logger = logging.getLogger("davinci-resolve-mcp.fairlight")

def get_audio_tracks(resolve, timeline_name: str = None) -> List[Dict]:
    """–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∞—É–¥–∏–æ–¥–æ—Ä–æ–∂–µ–∫ —Ç–∞–π–º–ª–∞–π–Ω–∞."""
    pass

def set_track_volume(resolve, track_index: int, volume_db: float) -> str:
    """–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≥—Ä–æ–º–∫–æ—Å—Ç—å –¥–æ—Ä–æ–∂–∫–∏ –≤ dB (-96 to +12)."""
    pass

def add_audio_effect(resolve, track_index: int, effect_name: str) -> str:
    """–î–æ–±–∞–≤–∏—Ç—å –∞—É–¥–∏–æ—ç—Ñ—Ñ–µ–∫—Ç –Ω–∞ –¥–æ—Ä–æ–∂–∫—É."""
    # –î–æ—Å—Ç—É–ø–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã: "Compressor", "EQ", "Limiter", "DeEsser", etc.
    pass

def normalize_audio(resolve, clip_name: str, target_lufs: float = -14.0) -> str:
    """–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–æ–º–∫–æ—Å—Ç–∏ –∫–ª–∏–ø–∞ –ø–æ LUFS —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É."""
    pass

def remove_silence(resolve, clip_name: str, threshold_db: float = -40) -> List[Dict]:
    """–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏ –≤–µ—Ä–Ω—É—Ç—å —Ç–∏—Ö–∏–µ —É—á–∞—Å—Ç–∫–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è."""
    pass

def voice_isolation(resolve, clip_name: str) -> str:
    """–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DaVinci Neural Engine –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –≥–æ–ª–æ—Å–∞."""
    # –¢—Ä–µ–±—É–µ—Ç DaVinci Resolve Studio
    pass
```

---

### 3.2 Fusion Page Operations

#### [NEW] [fusion_operations.py](file:///c:/GenModels/[Antigravity]/projects/test1/davinci-resolve-mcp/src/api/fusion_operations.py)

```python
"""DaVinci Resolve Fusion Page Operations"""

def get_fusion_comp(resolve, clip_name: str = None):
    """–ü–æ–ª—É—á–∏—Ç—å Fusion –∫–æ–º–ø–æ–∑–∏—Ü–∏—é —Ç–µ–∫—É—â–µ–≥–æ –∫–ª–∏–ø–∞."""
    pass

def add_text_node(resolve, text: str, font: str = "Arial", size: int = 100) -> str:
    """–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π —É–∑–µ–ª –≤ Fusion."""
    pass

def add_blur_effect(resolve, blur_size: float = 5.0) -> str:
    """–î–æ–±–∞–≤–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç —Ä–∞–∑–º—ã—Ç–∏—è."""
    pass

def create_lower_third(resolve, name: str, title: str, subtitle: str = "") -> str:
    """–°–æ–∑–¥–∞—Ç—å –Ω–∏–∂–Ω—é—é –ø–ª–∞—à–∫—É —Å –∏–º–µ–Ω–µ–º/—Ç–∏—Ç—É–ª–æ–º."""
    pass

def apply_template(resolve, template_name: str, **params) -> str:
    """–ü—Ä–∏–º–µ–Ω–∏—Ç—å Fusion template —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏."""
    pass
```

---

### 3.3 Smart Automation Tools

#### [MODIFY] [smart_editing.py](file:///c:/GenModels/[Antigravity]/projects/test1/davinci-resolve-mcp/src/api/smart_editing.py)

**–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**

```python
def auto_color_match(resolve, reference_clip: str, target_clips: List[str]) -> str:
    """–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ —Ü–≤–µ—Ç–∞ –ø–æ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å—É."""
    pass

def smart_reframe(resolve, clip_name: str, aspect_ratio: str = "9:16") -> str:
    """–£–º–Ω–æ–µ –∫–∞–¥—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –ª–∏—Ü–∞/–æ–±—ä–µ–∫—Ç–∞."""
    # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç DaVinci Neural Engine
    pass

def auto_subtitle(resolve, clip_name: str, style: str = "default") -> str:
    """–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å—É–±—Ç–∏—Ç—Ä–æ–≤ –∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏."""
    pass

def batch_export_reels(resolve, timeline_name: str, 
                       segment_markers: bool = True) -> List[str]:
    """–≠–∫—Å–ø–æ—Ä—Ç —Ç–∞–π–º–ª–∞–π–Ω–∞ –ø–æ –º–∞—Ä–∫–µ—Ä–∞–º –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã."""
    pass

def detect_scenes(resolve, clip_name: str, sensitivity: float = 0.5) -> List[Dict]:
    """–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–º–µ–Ω—ã —Å—Ü–µ–Ω –≤ –∫–ª–∏–ø–µ."""
    pass

def auto_music_sync(resolve, video_clip: str, music_clip: str) -> str:
    """–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–∞—Ä–µ–∑–∫–∏ –ø–æ–¥ —Ä–∏—Ç–º –º—É–∑—ã–∫–∏."""
    # –ê–Ω–∞–ª–∏–∑ BPM –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤
    pass
```

---

## –§–∞–∑–∞ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è üìã

> **–°—Ä–æ–∫:** –ü–æ—Å—Ç–æ—è–Ω–Ω–æ  
> **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

---

### 4.1 Unit Tests

#### [NEW] [tests/unit/](file:///c:/GenModels/[Antigravity]/projects/test1/davinci-resolve-mcp/tests/unit/)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤:**

```
tests/
‚îú‚îÄ‚îÄ unit/
‚îÇ   ‚îú‚îÄ‚îÄ test_ai_director.py      # –¢–µ—Å—Ç—ã parse_ai_segments
‚îÇ   ‚îú‚îÄ‚îÄ test_whisper_node.py     # –¢–µ—Å—Ç—ã —Å mock Whisper
‚îÇ   ‚îú‚îÄ‚îÄ test_jump_cut.py         # –¢–µ—Å—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–æ–Ω—Ç–∞–∂–Ω—ã—Ö —Ç–æ—á–µ–∫
‚îÇ   ‚îî‚îÄ‚îÄ test_error_handling.py   # –¢–µ—Å—Ç—ã –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤
‚îú‚îÄ‚îÄ integration/
‚îÇ   ‚îú‚îÄ‚îÄ test_project_operations.py
‚îÇ   ‚îú‚îÄ‚îÄ test_timeline_operations.py
‚îÇ   ‚îî‚îÄ‚îÄ test_media_operations.py
‚îú‚îÄ‚îÄ conftest.py                  # Pytest fixtures
‚îî‚îÄ‚îÄ mocks/
    ‚îî‚îÄ‚îÄ resolve_mock.py          # Mock DaVinci Resolve API
```

#### [NEW] [conftest.py](file:///c:/GenModels/[Antigravity]/projects/test1/davinci-resolve-mcp/tests/conftest.py)

```python
import pytest
from unittest.mock import MagicMock

@pytest.fixture
def mock_resolve():
    """Mock DaVinci Resolve instance."""
    resolve = MagicMock()
    
    # Project Manager
    pm = MagicMock()
    pm.GetCurrentProject.return_value = MagicMock()
    pm.GetProjectListInCurrentFolder.return_value = ["Project1", "Project2"]
    resolve.GetProjectManager.return_value = pm
    
    # Media Pool
    mp = MagicMock()
    mp.GetRootFolder.return_value = MagicMock()
    resolve.GetMediaPool.return_value = mp
    
    return resolve

@pytest.fixture
def sample_whisper_data():
    """Sample Whisper transcription output."""
    return {
        "segments": [
            {"start": 0.0, "end": 5.0, "text": "Hello world"},
            {"start": 5.5, "end": 10.0, "text": "This is a test"},
            {"start": 15.0, "end": 20.0, "text": "After silence"},
        ],
        "language": "en"
    }
```

---

### 4.2 –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

#### [NEW] [docs/API_REFERENCE.md](file:///c:/GenModels/[Antigravity]/projects/test1/davinci-resolve-mcp/docs/API_REFERENCE.md)

–ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ docstrings —Å –ø–æ–º–æ—â—å—é `pdoc` –∏–ª–∏ `mkdocs`.

---

## –ß–µ–∫–ª–∏—Å—Ç –∑–∞–¥–∞—á

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- [ ] –í—ã–Ω–µ—Å—Ç–∏ –ø—É—Ç–∏ Whisper –≤ –∫–æ–Ω—Ñ–∏–≥
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å [parse_ai_segments()](file:///c:/GenModels/%5BAntigravity%5D/projects/test1/davinci-resolve-mcp/src/api/ai_director.py#23-33)
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å `AddRenderJob`
- [ ] –î–æ–±–∞–≤–∏—Ç—å fallback –Ω–∞ Native Resolve AI

### –§–∞–∑–∞ 2: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
- [ ] –†–∞–∑–±–∏—Ç—å [resolve_mcp_server.py](file:///c:/GenModels/%5BAntigravity%5D/projects/test1/davinci-resolve-mcp/src/resolve_mcp_server.py) –Ω–∞ –º–æ–¥—É–ª–∏
- [ ] –£–¥–∞–ª–∏—Ç—å [scripts/resolve_mcp_server.py](file:///c:/GenModels/%5BAntigravity%5D/projects/test1/davinci-resolve-mcp/scripts/resolve_mcp_server.py)
- [ ] –°–æ–∑–¥–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- [ ] –î–æ–±–∞–≤–∏—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã `@require_resolve`, `@require_project`

### –§–∞–∑–∞ 3: –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- [ ] Fairlight operations (audio)
- [ ] Fusion operations (effects)
- [ ] Smart Reframe
- [ ] Auto Subtitles
- [ ] Scene Detection
- [ ] Music Sync

### –§–∞–∑–∞ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –°–æ–∑–¥–∞—Ç—å mock Resolve API
- [ ] Unit —Ç–µ—Å—Ç—ã –¥–ª—è ai_director
- [ ] Unit —Ç–µ—Å—Ç—ã –¥–ª—è jump_cut
- [ ] Integration —Ç–µ—Å—Ç—ã
- [ ] CI/CD pipeline (GitHub Actions)

---

## –†–µ—Å—É—Ä—Å—ã

- [DaVinci Resolve Scripting API](https://documents.blackmagicdesign.com/UserManuals/DaVinci-Resolve-Scripting-Guide.pdf)
- [MCP Protocol Specification](https://modelcontextprotocol.io/)
- [Whisper OpenAI](https://github.com/openai/whisper)
